# DiscobaMultimer
DiscobaMultimer is designed to perform highthroughput complex predictions with AlphaFold2-multimer on Discoba species, using LocalColabFold as AF2 implementation. TaxIDs for Discoba species where added to allow the generation of multiple sequence alignments using Discoba database (DiscobaMSA) for complexes, combining it or not with the corresponding ColabFoldMSA generated by ColabFold MSA server. There is also an implementation to run monomer structure predictions or just MSA retrivals.

For MSA generation only, no GPU is required. Take a look at this Colab notebook:
*To implement...

For complex structure predictions, GPU is required. Take a look at this notebook:
*To implement...

For monomeric structure predictions, GPU is required. Take a look at this notebook:
*To implement...

## Local installation (Ubuntu)
Before everything, update apt-get and make sure the dependencies are met:
  - Make sure curl, git and wget are installed:
    ```bash
    # Update apt-get
    sudo apt-get -y update

    # Install curl, git and wget
    sudo apt-get -y install curl git wget
    ```
  - Make sure you have LocalColabFold installed:
    ```bash
    # This must give no errors
    colabfold_batch -h
    ```
    If you get `colabfold_batch: command not found` error, install it following the installation instructions here: https://github.com/YoshitakaMo/localcolabfold.
  - Make sure you have Biopython package:
    ```bash
    pip install biopython    
    ```
  - Install emboss and hhsuite:
    ```bash
    sudo apt-get -y install emboss hhsuite
    ```
  - miniconda/anaconda???  <<<------------ (CHECK THIS ONE!!!) ----------------<<<

Once you are sure the dependencies are met, clone the repo and perform the installation:

```bash
# Clone the repo and cd to DiscobaMultimer
git clone https://github.com/elviorodriguez/DiscobaMultimer.git
cd DiscobaMultimer

# Install DiscobaMultimer
bash install/install_MMseqs2_and_DiscobaDB.sh install
```

This will take a few minutes, as MMseqs2 is installed and DiscobaDB is built. In general, the istallation of LocalColabFold adds mmseqs to the path, and MMseqs2 installation is skipped. After installation is completed, restart the shell (or `cd ~/` and then `source ~/.bashrc`).

Check the installation with:
```bash
# This will show you the help message for complex prediction
discoba_multimer_batch


# This will show you the help message for monomer prediction
discoba_monomer_batch
```

## How does it work?
DiscobaMultimer requieres 2 positional arguments, a file with fasta sequences `database.fasta` (in general will be the proteome) and a file with combinations of **IDs separated with TABS** `IDs_table.txt` to search for them in the database:

```bash
discoba_multimer_batch [OPTIONS] <database.fasta> <IDs_table.txt>
discoba_monomer_batch [OPTIONS] <database.fasta> <IDs_table.txt>
```

The options will manage what you want to retrieve (MSA, MSA plot, AF2 predictions, etc) and the configuration of each run.

The fasta sequences on `database.fasta` must contain headers **ONLY with the ID of each sequence**. For example:

```bash
>Tb927.11.7160
MEQQGDSEAKEHGELTRNGITDNAYDNSVGAFNRTILDRYAHWMTQLDQGACGLRIWKAE
ELWKRYERVIRVGRGSFGSVFIVYDTERKAYLTVKCMELLGKPGPALRSLSQPTLREVIL
LSQIDHPNVVRLIDYYLTSDGMLHMCMPIVSHDLVSLIRIWKMRGPRGESSLGRMPLPTV
KCVFRQLLRGLEYLHRRNIIHRDLKPSNVMLDDNGVVKIVDFGWARFVPRRWQGRLTGPP
CVVTYRPPEILLGGQCSFKYDSSIDIWSAGCILYEMLTGGKAFSNARNEQQALAAITDML
GSPSSRSEVYYGAAGGSRLRPSKRQPRNFEERCRMVNMSNESIDFLGEMLQLEPNSRKSA
SQLLGHSWFSTSPLPCEPEEVSLPGSNTYRLLERKRTR
>Tb927.10.13720
MAHVGQQRFGCYIGNIDRSVTLEVLRQVFSQCGTIVDCSLNGRDEDPYRYGFIDFATEDD
RARAMKYNGFTLAGRKIKVGISKGNVGRPEGYNNNPTPAPAASNTASSAGQHPQVPSQPQ
VPAVSVPASFLPGMVQQQQQQGATLLLQLLQQGAIDVNNLTAEQQQVLMASLLPQAPAAA
PGMHVMPPTAPMAYVPPPPQQPWGAPRGVYAGGPLGRPAPYTRPPANPQPPEETLKLREV
QRKQFLDVVRRDAEKYERKLAERNLKEGRTGSISGSEESSSDEEGEKGHRHSRRKIEGGE
DTEPEKSATLPMKTESDSVSCPMEVNCNNEGANISGEEAASNGNGGESNNNEDGDAIDCS
NVETEENNVDEEVENKC
>Tb927.4.1610
MIPPAKLNDFFNIVDDFLKKTFRDESFLFAAVKSRQYSESFPGEQLFFTSPPSATTDQPS
DESLQAGGGELRKTQNFMYFSPRLIFNRDGGYHGKVKLHSGVHVPQVCRFEQGIAVNSEG
LASGSVKVSDLLEGMEVKGRLAVNTIAPPSKDVWSVAMDYQRRDFYSTLNYQRNGLGSSD
LLVDCGTKFFNLLAGAGFERQKVSFLEQQDHTAQLDVLYAGVGFTGVNWSVGAKLVRAND
MWSAARIAFYQRVVPDTSVACAYNFDMEESRVHVSLGFSQGFRLRVPTILQQRACEQLDV
WTAILPFVGAFKAESGGLCAATIRGIFNGVVHWGLVAQKNVLVENSPIRFGLTLSVESG
```

For `IDs_table.txt`, each line will correspond to a prediction. For example:

```
Tb927.11.7160  Tb927.10.13720
Tb927.11.7160  Tb927.4.1610  Tb927.4.1610
Tb927.11.7160  Tb927.11.7160
```

This means that DiscobaMultimer will generate predictions for an heterodimer (first line), an heterotrimer (second line) and a homodimer (third line). Do not separate the the IDs with spaces or commas, only **TABS** will work.

NOTE: If you want to modify the headers of each sequence to other names, you can. Just do not add spaces or "-" to the new names. Also, make the corresponding change in the IDs file.


## Running batchs of complex structures predictions


## Running batchs of monomer structures predictions


## Running batchs of DiscobaMSA only predictions


## Setting size restrictions to avoid memory crashes

